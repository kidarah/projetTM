<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Profil du Chef (Modale)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    body {
      background-color: #121212;
      font-family: 'Poppins', sans-serif;
      color: #fff;
      padding-top: 80px;
    }
    .profile-card {
      background-color: #1f1f1f;
      max-width: 900px;
      margin: auto;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    .top-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 30px;
      flex-wrap: wrap;
    }
    .top-section img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid #fed402;
    }
    .info { flex: 1; }
    .info h2 { margin: 0; color: #fed402; }
    .rating { text-align: right; font-size: 24px; }
    .rating span { color: #fed402; font-size: 28px; }
    .bio {
      margin-top: 20px;
      background-color: #2a2a2a;
      padding: 15px;
      border-radius: 10px;
      font-size: 15px;
      color: #ddd;
    }
    .gallery {
      margin-top: 30px;
    }
    .gallery h3 { color: #fed402; margin-bottom: 15px; }
    .gallery-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .gallery-grid img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
    }
    .form-upload {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
    .form-upload input {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 8px;
    }
    .form-upload button {
      background-color: #fed402;
      color: #000;
      border: none;
      padding: 10px 15px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
    }
    .form-upload button:hover {
      background-color: #e5c402;
    }
  </style>
</head>
<body>

<div class="profile-card">
  <div class="top-section">
    <img id="chefPhoto" src="" alt="Chef">
    <div class="info">
      <h2 id="chefNom">Chef Inconnu</h2>
      <p id="chefSpecialite">Spécialité : inconnue</p>
    </div>
    <div class="rating"><span>★</span> 4.8</div>
  </div>

  <div class="bio" id="chefBio">Aucune biographie pour le moment</div>

  <div class="gallery">
    <h3>Plats préparés</h3>
    <div class="gallery-grid" id="galleryGrid"></div>
    <div class="form-upload">
        <input type="file" id="photoPlatFile" accept="image/*">
        <button onclick="ajouterPlat()">Ajouter</button>
      </div>
  </div>

  <div style="text-align:center; margin-top: 30px;">
    <button class="btn btn-warning text-dark" data-bs-toggle="modal" data-bs-target="#editModal">Modifier le profil</button>
  </div>
</div>

<!-- MODALE -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header">
        <h5 class="modal-title" id="editModalLabel">Modifier mon profil</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fermer"></button>
      </div>
      <div class="modal-body text-center">
        <input class="form-control mb-2" id="editNom" placeholder="Nom complet">
        <input class="form-control mb-2" id="editSpecialite" placeholder="Spécialité">
        <textarea class="form-control mb-2" id="editBio" placeholder="Biographie..."></textarea>
      
        <!-- Upload fichier image -->
        <input type="file" class="form-control mb-2" id="photoUpload" accept="image/*">
        <img id="photoPreview" src="" alt="Prévisualisation" style="margin-top:10px; width:100px; height:100px; object-fit:cover; border-radius: 50%; display:none;">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
        <button type="button" class="btn btn-warning text-dark" onclick="saveProfil()">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<script>
  let profil = JSON.parse(localStorage.getItem("profilChef")) || {
    nom: "Chef Inconnu",
    specialite: "inconnue",
    bio: "Aucune biographie pour le moment",
    photo: "",
    plats: []
  };

  document.getElementById("chefNom").innerText = profil.nom;
  document.getElementById("chefSpecialite").innerText = "Spécialité : " + profil.specialite;
  document.getElementById("chefBio").innerText = profil.bio;
  document.getElementById("chefPhoto").src = profil.photo;

  const gallery = document.getElementById("galleryGrid");
  profil.plats.forEach(url => {
    const img = document.createElement("img");
    img.src = url;
    gallery.appendChild(img);
  });

  function ajouterPlat() {
   const fileInput = document.getElementById("photoPlatFile");
   const file = fileInput.files[0];
    if (!file) return;

   const reader = new FileReader();
    reader.onload = function (e) {
        const base64 = e.target.result;
        const profil = JSON.parse(localStorage.getItem("profilChef")) || { plats: [] };
        profil.plats = profil.plats || [];
        profil.plats.push(base64);
        localStorage.setItem("profilChef", JSON.stringify(profil));

        const img = document.createElement("img");
        img.src = base64;
        document.getElementById("galleryGrid").appendChild(img);

        fileInput.value = ""; // reset input
    };
   reader.readAsDataURL(file);
  }


  function saveProfil() {
   const profil = window.currentProfil || {};

   profil.nom = document.getElementById("editNom").value;
   profil.specialite = document.getElementById("editSpecialite").value;
   profil.bio = document.getElementById("editBio").value;

   const fileInput = document.getElementById("photoUpload");
    if (fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function (e) {
        profil.photo = e.target.result;
        localStorage.setItem("profilChef", JSON.stringify(profil));
        location.reload();
        };
        reader.readAsDataURL(fileInput.files[0]);
    } else {
        localStorage.setItem("profilChef", JSON.stringify(profil));
        location.reload();
    }
  }


  // Pré-remplir la modale quand elle s’ouvre
  document.getElementById('editModal').addEventListener('show.bs.modal', function () {
    const profil = JSON.parse(localStorage.getItem("profilChef")) || {
        nom: "Chef Inconnu",
        specialite: "inconnue",
        bio: "Aucune bio pour le moment",
        photo: "",
        plats: []
    };
  document.getElementById("editNom").value = profil.nom || "";
  document.getElementById("editSpecialite").value = profil.specialite || "";
  document.getElementById("editBio").value = profil.bio || "";

  const preview = document.getElementById("photoPreview");
    if (profil.photo) {
        preview.src = profil.photo;
        preview.style.display = "block";
    } else {
        preview.style.display = "none";
    }

  // Pour permettre à saveProfil() d’y accéder : stocker temporairement
  window.currentProfil = profil;
  });

</script>

</body>
</html>
