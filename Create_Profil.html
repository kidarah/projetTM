<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Chef Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="create_profil.css">
  <link rel="stylesheet" href="custom_upload.css">
</head>

<body>
  <div class="container profile-container shadow-lg">
    <!-- Top Row -->
    <div class="d-flex flex-wrap align-items-start justify-content-between gap-4">
      <!-- Profile Picture -->
      <div class="profile-pic">
        <img id="chefPhoto" src="" alt="Profile Picture">
      </div>

      <!-- Info -->
      <div class="flex-grow-1">
        <div class="d-flex justify-content-between align-items-center">
          <h2 id="chefNom" class="chef-name">Chef Name</h2>
          <div class="rating">â˜… 4.8</div>
        </div>
        <p id="chefSpecialite" class="specialty">Specialty: Unknown</p>
        <div id="chefBio" class="bio-box">No biography available yet.</div>
      </div>

      <!-- Edit Button -->
      <div>
        <button class="btn btn-warning text-dark" data-bs-toggle="modal" data-bs-target="#editModal">Edit
          Profile</button>
      </div>
    </div>

    <!-- Upload Button -->
    <div id="addDishBlock" class="mt-4 text-center">
      <label for="photoPlatFile" class="custum-file-upload">
        <div class="icon">
          <svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 0 48 48" fill="#fed402">
            <path
              d="M22.5 34.55h3V25h9.55v-3H25.5v-9.55h-3V22H13v3h9.5ZM9 42q-1.25 0-2.125-.875T6 39V9q0-1.25.875-2.125T9 6h13.1q.6 0 1.075.25T24.9 7.1l2.05 2.05H39q1.25 0 2.125.875T42 12v27q0 1.25-.875 2.125T39 42Zm0-3h30V12H25.15L21.95 8.8H9v30Z" />
          </svg>
        </div>
        <div class="text"><span>Add Dish</span></div>
        <input id="photoPlatFile" type="file" accept="image/*" onchange="addDish()">
      </label>
    </div>

    <!-- Gallery -->
    <div class="gallery mt-4">
      <h4 class="text-warning">Prepared Dishes</h4>
      <div class="gallery-grid" id="galleryGrid"></div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-white">
        <div class="modal-header">
          <h5 class="modal-title">Edit Profile</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <input class="form-control mb-2" id="editNom" placeholder="Name">
          <input class="form-control mb-2" id="editSpecialite" placeholder="Specialty">
          <textarea class="form-control mb-2" id="editBio" placeholder="Biography..."></textarea>
          <input type="file" class="form-control mb-2" id="photoUpload" accept="image/*">
          <img id="photoPreview"
            style="display:none; width:100px; height:100px; object-fit:cover; border-radius:50%; margin-top:10px;">
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" onclick="resetPreview()">Cancel</button>
          <button class="btn btn-warning text-dark" onclick="saveProfile()">Save</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    if (!localStorage.getItem("chefs")) localStorage.setItem("chefs", JSON.stringify([]));
    if (!localStorage.getItem("currentChef")) localStorage.setItem("currentChef", JSON.stringify({ email: "chef@example.com" }));

    function getChefProfile() {
      const current = JSON.parse(localStorage.getItem("currentChef"));
      const chefs = JSON.parse(localStorage.getItem("chefs")) || [];
      let profile = chefs.find(c => c.email === current.email);
      if (!profile) {
        profile = {
          email: current.email,
          nom: "Unknown Chef",
          specialite: "Unknown",
          bio: "No biography available yet.",
          photo: "",
          plats: []
        };
        chefs.push(profile);
        localStorage.setItem("chefs", JSON.stringify(chefs));
      }
      return profile;
    }

    function renderProfile(profile) {
      document.getElementById("chefNom").innerText = profile.nom;
      document.getElementById("chefSpecialite").innerText = "Specialty: " + profile.specialite;
      document.getElementById("chefBio").innerText = profile.bio;
      document.getElementById("chefPhoto").src = profile.photo || "https://source.unsplash.com/120x120/?chef";
      const gallery = document.getElementById("galleryGrid");
      gallery.innerHTML = "";
      if (profile.plats?.length > 0) {
        profile.plats.forEach(src => {
          const img = document.createElement("img");
          img.src = src;
          img.classList.add("gallery-img");
          gallery.appendChild(img);
        });
      } else {
        gallery.innerHTML = "<p class='text-muted'>No dish uploaded yet.</p>";
      }
    }

    function saveProfile() {
      const current = JSON.parse(localStorage.getItem("currentChef"));
      const chefs = JSON.parse(localStorage.getItem("chefs"));
      const index = chefs.findIndex(c => c.email === current.email);
      const updated = {
        ...chefs[index],
        nom: document.getElementById("editNom").value,
        specialite: document.getElementById("editSpecialite").value,
        bio: document.getElementById("editBio").value
      };
      const fileInput = document.getElementById("photoUpload");
      if (fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function (e) {
          updated.photo = e.target.result;
          chefs[index] = updated;
          localStorage.setItem("chefs", JSON.stringify(chefs));
          renderProfile(updated);
        };
        reader.readAsDataURL(fileInput.files[0]);
      } else {
        chefs[index] = updated;
        localStorage.setItem("chefs", JSON.stringify(chefs));
        renderProfile(updated);
      }
      bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
    }

    function resetPreview() {
      document.getElementById("photoUpload").value = "";
      document.getElementById("photoPreview").style.display = "none";
    }

    function addDish() {
      const file = document.getElementById("photoPlatFile").files[0];
      if (!file) return;
      const current = JSON.parse(localStorage.getItem("currentChef"));
      const chefs = JSON.parse(localStorage.getItem("chefs"));
      const index = chefs.findIndex(c => c.email === current.email);
      const reader = new FileReader();
      reader.onload = function (e) {
        chefs[index].plats.push(e.target.result);
        localStorage.setItem("chefs", JSON.stringify(chefs));
        renderProfile(chefs[index]);
      };
      reader.readAsDataURL(file);
    }

    document.getElementById("editModal").addEventListener("show.bs.modal", () => {
      const profile = getChefProfile();
      document.getElementById("editNom").value = profile.nom;
      document.getElementById("editSpecialite").value = profile.specialite;
      document.getElementById("editBio").value = profile.bio;
      const preview = document.getElementById("photoPreview");
      if (profile.photo) {
        preview.src = profile.photo;
        preview.style.display = "block";
      } else {
        preview.style.display = "none";
      }
    });

    renderProfile(getChefProfile());
  </script>

</body>

</html>