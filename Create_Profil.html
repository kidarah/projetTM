<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chef Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="create_profil.css">
</head>
<body>

<div class="profile-container">

  <!-- Header -->
  <div class="profile-header">
    <div class="profile-image">
      <img id="chefPhoto" src="" alt="Chef profile picture">
    </div>
    <div class="profile-details">
      <h1 id="chefNom">Chef Name</h1>
      <p id="chefSpecialite">Specialty: Unknown</p>
      <div class="rating">★ 4.8</div>
    </div>
    <div class="edit-button-absolute d-none" id="editBtnWrapper">
      <button id="editBtn" class="edit-btn" onclick="toggleEdit()">Edit Profile</button>
    </div>    
  </div>

  <!-- Description -->
  <section class="profile-section">
    <h2>About</h2>
    <p id="chefBio">No biography available yet.</p>
  </section>

  <!-- Gallery -->
  <section class="profile-section">
    <h2>Dishes Gallery</h2>
    <div class="gallery-grid" id="galleryGrid"></div>
    <label for="photoPlatFile" class="upload-box d-none" id="uploadLabel">
      <span>➕ Add Dish</span>
      <input id="photoPlatFile" type="file" accept="image/*" onchange="addDish()" />
    </label>
  </section>

  <!-- Reviews -->
  <section class="profile-section">
    <h2>Reviews</h2>
    <div id="reviewsContainer" class="reviews">
      <p class="empty-reviews">No reviews yet.</p>
    </div>
  </section>

</div>

<!-- Edit Modal -->
<div class="modal hidden" id="editModal">
  <div class="modal-content">
    <h3>Edit Profile</h3>
    <input type="text" id="editNom" placeholder="Name">
    <input type="text" id="editSpecialite" placeholder="Specialty">
    <textarea id="editBio" placeholder="Biography..."></textarea>
    <input type="file" id="photoUpload" accept="image/*">
    <div class="modal-actions">
      <button onclick="saveProfile()">Save</button>
      <button onclick="toggleEdit()">Cancel</button>
    </div>
  </div>
</div>

<script>
  function toggleEdit() {
    document.getElementById("editModal").classList.toggle("hidden");
    const profile = getChefProfile();
    document.getElementById("editNom").value = profile.nom;
    document.getElementById("editSpecialite").value = profile.specialite;
    document.getElementById("editBio").value = profile.bio;
  }

  function saveProfile() {
    const current = JSON.parse(localStorage.getItem("currentChef"));
    const chefs = JSON.parse(localStorage.getItem("chefs"));
    const index = chefs.findIndex(c => c.email === current.email);
    chefs[index].nom = document.getElementById("editNom").value;
    chefs[index].specialite = document.getElementById("editSpecialite").value;
    chefs[index].bio = document.getElementById("editBio").value;

    const file = document.getElementById("photoUpload").files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        chefs[index].photo = e.target.result;
        localStorage.setItem("chefs", JSON.stringify(chefs));
        renderProfile(chefs[index]);
      };
      reader.readAsDataURL(file);
    } else {
      localStorage.setItem("chefs", JSON.stringify(chefs));
      renderProfile(chefs[index]);
    }

    toggleEdit();
  }

  function getChefProfile() {
    const current = JSON.parse(localStorage.getItem("currentChef"));
    const chefs = JSON.parse(localStorage.getItem("chefs")) || [];
    return chefs.find(c => c.email === current.email);
  }

  function renderProfile(profile) {
    document.getElementById("chefNom").innerText = profile.nom;
    document.getElementById("chefSpecialite").innerText = "Specialty: " + profile.specialite;
    document.getElementById("chefBio").innerText = profile.bio;
    document.getElementById("chefPhoto").src = profile.photo || "https://source.unsplash.com/120x120/?chef";

    const gallery = document.getElementById("galleryGrid");
    gallery.innerHTML = "";
    (profile.plats || []).forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      img.classList.add("gallery-img");
      gallery.appendChild(img);
    });
  }

  function addDish() {
    const file = document.getElementById("photoPlatFile").files[0];
    if (!file) return;
    const current = JSON.parse(localStorage.getItem("currentChef"));
    const chefs = JSON.parse(localStorage.getItem("chefs"));
    const index = chefs.findIndex(c => c.email === current.email);

    const reader = new FileReader();
    reader.onload = function (e) {
      chefs[index].plats = chefs[index].plats || [];
      chefs[index].plats.push(e.target.result);
      localStorage.setItem("chefs", JSON.stringify(chefs));
      renderProfile(chefs[index]);
    };
    reader.readAsDataURL(file);
  }

  const profile = getChefProfile();
  renderProfile(profile);

  if (profile.email === JSON.parse(localStorage.getItem("currentChef")).email) {
    document.getElementById("editBtn").classList.remove("d-none");
    document.getElementById("uploadLabel").classList.remove("d-none");
  }
</script>

</body>
</html>
